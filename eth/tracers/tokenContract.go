package tracers

import (
	"github.com/celo-org/celo-blockchain/accounts/abi"
	"github.com/celo-org/celo-blockchain/common"
	"github.com/celo-org/celo-blockchain/common/hexutil"
	"github.com/celo-org/celo-blockchain/internal/ethapi"
	"strings"
)

var (
	_jsondata = `
[
	{
		"inputs": [
			{
				"internalType": "address[]",
				"name": "tokens",
				"type": "address[]"
			}
		],
		"name": "balance",
		"outputs": [
			{
				"internalType": "bool[]",
				"name": "",
				"type": "bool[]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	}
]
`
	_code     = "0x608060405234801561001057600080fd5b50610371806100206000396000f3fe608060405234801561001057600080fd5b506004361061002b5760003560e01c8063cadda4ba14610030575b600080fd5b6100e66004803603602081101561004657600080fd5b810190808035906020019064010000000081111561006357600080fd5b82018360208201111561007557600080fd5b8035906020019184602083028401116401000000008311171561009757600080fd5b919080806020026020016040519081016040528093929190818152602001838360200280828437600081840152601f19601f82011690508083019250505050505050919291929050505061013d565b6040518080602001828103825283818151815260200191508051906020019060200280838360005b8381101561012957808201518184015260208101905061010e565b505050509050019250505060405180910390f35b60608082516040519080825280602002602001820160405280156101705781602001602082028038833980820191505090505b50905060008090505b835181101561033157600084828151811061019057fe5b602002602001015173ffffffffffffffffffffffffffffffffffffffff1630604051602401808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019150506040516020818303038152906040527f70a08231000000000000000000000000000000000000000000000000000000007bffffffffffffffffffffffffffffffffffffffffffffffffffffffff19166020820180517bffffffffffffffffffffffffffffffffffffffffffffffffffffffff83818316178352505050506040518082805190602001908083835b6020831061029b5780518252602082019150602081019050602083039250610278565b6001836020036101000a038019825116818451168082178552505050505050905001915050600060405180830381855afa9150503d80600081146102fb576040519150601f19603f3d011682016040523d82523d6000602084013e610300565b606091505b505090508083838151811061031157fe5b602002602001019015159081151581525050508080600101915050610179565b508091505091905056fea26469706673582212205fd51f1e001f2738b0dcc04d244be210f83e728ad8706e88f1e1fc36f31e8cbc64736f6c63430006000033"
	_caller   = "0x1992111111111111111111111111111111111110"
	_contract = "0x1992111111111111111111111111111111111111"
)

type TokenContract struct {
	caller  common.Address
	address common.Address
	code    []byte
	abi     abi.ABI
}

func NewTokenContract() TokenContract {
	_abi, _ := abi.JSON(strings.NewReader(_jsondata))
	return TokenContract{
		caller:  common.HexToAddress(_caller),
		address: common.HexToAddress(_contract),
		code:    hexutil.MustDecode(_code),
		abi:     _abi,
	}
}

func (tc *TokenContract) Override() *ethapi.StateOverride {
	return &ethapi.StateOverride{
		tc.address: ethapi.OverrideAccount{
			Nonce:     nil,
			Code:      (*hexutil.Bytes)(&tc.code),
			Balance:   nil,
			State:     nil,
			StateDiff: nil,
		},
	}
}
